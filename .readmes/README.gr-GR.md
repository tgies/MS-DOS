<img width="150" height="150" align="left" style="float: left; margin: 0 10px 0 0;" alt="MS-DOS logo" src="https://github.com/Microsoft/MS-DOS/blob/main/.readmes/msdos-logo.png">

# Πηγαίος Κώδικας του MS-DOS v1.25, v2.0, v4.0

[![Build MS-DOS 4](https://github.com/tgies/MS-DOS/actions/workflows/build.yml/badge.svg)](https://github.com/tgies/MS-DOS/actions/workflows/build.yml)

Αυτό το αποθετήριο περιέχει τον πρωτότυπο πηγαίο-κώδικα και τα μεταγλωττισμένα δυαδικά αρχεία για το MS-DOS v1.25 και το MS-DOS v2.0, συν τον πηγαίο κώδικα για το MS-DOS v4.00 που αναπτύχθηκε από κοινού από την IBM και τη Microsoft.

Τα αρχεία του MS-DOS v1.25 και v2.0 [αρχικά μετήχθησαν στο Μουσείο Ιστορίας των Κομπιούτερ στις 25 Μαρτίου 2014](http://www.computerhistory.org/atchm/microsoft-ms-dos-early-source-code/) και τώρα (ξανά)εκδίδονται σε αυτό το αποθετήριο για να γίνει ευκολότερο να βρεθούν, να παραπεμπθούν σε εξωτερικά κείμενα και εργασίες, και να επιτραπεί η εξερεύνηση και ο πειραματισμός σε όσους ενδιαφέρονται για τα αρχικά λειτουργικά συστήματα PC.

# Σχετικά με αυτό το fork

Αυτό το fork προσθέτει ένα λειτουργικό σύστημα κατασκευής και μια διαδικασία CI για τον πηγαίο κώδικα του MS-DOS 4.0. Κατασκευάζει τους αυθεντικούς πηγαίους κώδικες 8086 assembly και C σε ένα πλήρες, εκκινήσιμο λειτουργικό σύστημα -- τόσο την OEM έκδοση **MS-DOS** όσο και την έκδοση **IBM PC-DOS**.

Η κατασκευή παράγει έτοιμες για χρήση εικόνες δίσκου (σκληρός δίσκος 64MB και ιστορικά ακριβείς δισκέτες από 360KB έως 1.44MB) που εκκινούν σε QEMU, VirtualBox, bochs, dosemu, 86Box, PCem, ή σε πραγματικό παλαιό υλικό. Προκατασκευασμένες εικόνες είναι διαθέσιμες στη σελίδα [Releases](https://github.com/tgies/MS-DOS/releases).

Αυτή η δουλειά επωφελείται σημαντικά από προηγούμενη δουλειά που έγινε από άλλους για να κατασκευαστεί ο πηγαίος κώδικας του MS-DOS 4.0, καθαρίζοντας κάποια μικρά προβλήματα στο δέντρο πηγαίου κώδικα που κυκλοφόρησε (λάθος διαδρομές αρχείων και παραμορφωμένες κωδικοποιήσεις χαρακτήρων), συμπεριλαμβανομένων, ενδεικτικά, του [ecm](https://hg.pushbx.org/ecm/msdos4) και του [hharte](https://github.com/hharte/MS-DOS/commit/1f506100a818cb9b6c2b29aeda8d4d24d094c477).

# Δοκιμάστε το

Κατεβάστε το `msdos4.img` από την [τελευταία έκδοση](https://github.com/tgies/MS-DOS/releases) και εκκινήστε το:

```bash
qemu-system-i386 -hda msdos4.img
```

Ή με το DOSBox, ξεκινήστε το DOSBox κανονικά και μετά εκκινήστε την εικόνα (παραλείψτε το `-l C` αν χρησιμοποιείτε εικόνα δισκέτας):

```bash
BOOT msdos4.img -l C
```

Ή με το dosemu (κατεβάστε το `msdos4-dosemu.img`, που έχει μια ειδική κεφαλίδα για το dosemu2):

```bash
dosemu -f <(echo '$_hdimage = "msdos4-dosemu.img"')
```

# Άδεια

Όλα τα αρχεία σε αυτό το αποθετήριο έχουν κυκλοφορήσει υπό το [Άδεια MIT](https://en.wikipedia.org/wiki/MIT_License) όπως αναφέρεται στο [αρχείο LICENSE](https://github.com/Microsoft/MS-DOS/blob/main/LICENSE) που είναι αποθηκευμένο στη ρίζα αυτού του αποθετηρίου.

# Για ιστορική αναφορά

> **ΣΗΜΕΙΩΣΗ:** Αυτή η ενότητα διατηρείται από το αρχικό README.md της Microsoft που συνόδευε την κυκλοφορία του πηγαίου κώδικα. Τα build scripts και τα εργαλεία σε αυτό το αποθετήριο συντηρούνται ξεχωριστά από τον ιστορικό πηγαίο κώδικα. Αιτήσεις Έλξης (Pull Requests) για βελτιώσεις στο σύστημα κατασκευής είναι ευπρόσδεκτες.

Τα αρχεία πηγαίου κώδικα σε αυτό το αποθετήριο υπάρχουν για ιστορική αναφορά και θα κρατηθούν στατικά, για αυτό παρακαλούμε **μην στείλετε** Αιτήσεις Έλξης που να προτείνουν μετατροπές στα αρχεία πηγαίου κώδικα, αλλά νιώστε ελεύθεροι να κάνετε fork αυτό το αποθετήριο και να πειραματιστείτε 😊.

Αυτό το project έχει υιοθετήσει τον [Κώδικα Δεοντολογίας Ανοιχτού Κώδικα της Microsoft](https://opensource.microsoft.com/codeofconduct/). Για περισσότερες πληροφορίες δείτε τις [Συχνές Ερωτήσεις του Κώδικα Δεοντολογίας](https://opensource.microsoft.com/codeofconduct/faq/) ή επικοινωνήστε στο [opencode@microsoft.com](mailto:opencode@microsoft.com) με επιπλέον ερωτήσεις ή σχόλια.

# Κατασκευή του MS-DOS 4.0

Προκατασκευασμένες εικόνες δίσκου είναι διαθέσιμες στη σελίδα [Releases](https://github.com/tgies/MS-DOS/releases). Για να κατασκευάσετε από τον πηγαίο κώδικα:

## Απαιτήσεις

- dosemu2
- mtools
- mkfatimage16 (από το dosemu2)

> [!IMPORTANT]
> **Απαιτείται comcom64 0.4-0~202602051302 ή νεότερο.** Το comcom64 είναι το αντικατάστατο του command.com που χρησιμοποιείται από το dosemu2. Κάποιες παλαιότερες εκδόσεις έχουν ένα [bug στην εντολή `COPY`](https://github.com/dosemu2/comcom64/pull/117) που σπάει τη συγχώνευση αρχείων (`copy /b a+b dest`) όταν καλείται μέσω `COMMAND /C`, το οποίο χρησιμοποιεί το nmake για την εκτέλεση εντολών makefile. Αυτό προκαλεί αθόρυβη αποτυχία στην κατασκευή του IO.SYS.
>
> Ελέγξτε την έκδοσή σας με `dpkg -s comcom64 | grep Version` (Debian/Ubuntu) ή ελέγξτε τον διαχειριστή πακέτων σας. Αν έχετε παλαιότερη έκδοση:
> - **Συνιστάται:** Ενημερώστε το comcom64 σε 0.4-0~202602051302 ή νεότερο
> - **Εναλλακτική λύση:** Κατασκευάστε το comcom64 από τον πηγαίο κώδικα: `git clone https://github.com/dosemu2/comcom64 && cd comcom64 && make && sudo make install` (βεβαιωθείτε ότι το `make install` εγκαθιστά πάνω από το υπάρχον `command.efi`)

## Γρήγορη Εκκίνηση

```bash
cd v4.0
./mak.sh              # Κατασκευή DOS 4
./mkhdimg.sh          # Δημιουργία εικόνας σκληρού δίσκου 64MB
./mkhdimg.sh --floppy # Δημιουργία εικόνας εκκίνησης δισκέτας 1.44MB
```

## Παραλλαγές Κατασκευής

Ο πηγαίος κώδικας υποστηρίζει πολλαπλές διαμορφώσεις κατασκευής. Χρησιμοποιήστε τη σημαία `--flavor`:

```bash
./mak.sh                    # Κατασκευή MS-DOS (προεπιλογή)
./mak.sh --flavor=pcdos     # Κατασκευή IBM PC-DOS
```

| Παραλλαγή | Αρχεία Συστήματος | Περιγραφή |
|--------|--------------|-------------|
| **msdos** | IO.SYS, MSDOS.SYS | OEM MS-DOS για IBM-συμβατά PC (προεπιλογή, συνιστάται) |
| **pcdos** | IBMBIO.COM, IBMDOS.COM | IBM PC-DOS (για ιστορική ακρίβεια) |

Και οι δύο παραλλαγές περιλαμβάνουν κώδικα ειδικό για το υλικό IBM PC (INT 10H video BIOS, 8259 PIC, υποστήριξη ROM cartridge για PCjr).

**Σημαντικό:** Η παραλλαγή **msdos** περιέχει περισσότερες διορθώσεις bugs από την **pcdos**. Πιθανώς, η Microsoft μπορούσε να προωθήσει διορθώσεις στο OEM MS-DOS ταχύτερα από ό,τι επέτρεπε η διαδικασία έγκρισης της IBM για το PC-DOS. Είναι γνωστό ότι η IBM ουσιαστικά ανέλαβε προσωρινά την ανάπτυξη του DOS περίπου από το DOS 3.3 έως το DOS 4.0, οπότε μια πιθανή θεωρία είναι ότι το PC-DOS θεωρήθηκε ουσιαστικά παγωμένο όταν ο κώδικας επιστράφηκε στη Microsoft, η οποία βρήκε έναν αριθμό bugs που διόρθωσε στο OEM MS-DOS χωρίς να αγγίξει το PC-DOS.

Αξιοσημείωτες διαφορές:
- Διόρθωση διαχείρισης INT 24 (κρίσιμο σφάλμα) του πυρήνα DOS
- Προστασία από υπερχείλιση ακεραίων στο FDISK για μεγάλους δίσκους
- Μεγαλύτερα buffers EMS στο FASTOPEN
- Καλύτερη επικύρωση εισόδου στο EXE2BIN

Η προεπιλεγμένη παραλλαγή **msdos** είναι αυτή που οι OEMs όπως η Compaq, η Dell και η HP έστελναν ως "MS-DOS" στα IBM-συμβατά PC τους. Αυτή η κυκλοφορία πηγαίου κώδικα φαίνεται να προέρχεται από το OAK (OEM Adaptation Kit) -- τον κώδικα που η Microsoft παρείχε στους OEMs για να τους επιτρέψει να προσαρμόσουν το MS-DOS για το υλικό τους.

## Επιλογές Εικόνας Δίσκου

```bash
# Εικόνες σκληρού δίσκου (παράγει msdos4.img + msdos4-dosemu.img)
./mkhdimg.sh                    # Εικόνα FAT16 64MB
./mkhdimg.sh --size 32          # Εικόνα 32MB

# Εικόνες δισκέτας (όλα τα μεγέθη)
./mkhdimg.sh --floppy           # 1.44MB ελάχιστη (μόνο αρχεία συστήματος)
./mkhdimg.sh --floppy=360 --floppy-full   # 360KB με εργαλεία
./mkhdimg.sh --floppy=720 --floppy-full   # 720KB με εργαλεία
./mkhdimg.sh --floppy=1200 --floppy-full  # 1.2MB με εργαλεία
./mkhdimg.sh --floppy=1440 --floppy-full  # 1.44MB με εργαλεία
```

Οι εικόνες σκληρού δίσκου παράγονται σε δύο μορφές: το `msdos4.img` είναι μια ακατέργαστη (raw) εικόνα δίσκου που λειτουργεί με QEMU, VirtualBox, bochs και τους περισσότερους emulators. Το `msdos4-dosemu.img` είναι σε μορφή hdimage του dosemu (κεφαλίδα 128 bytes). Οι εικόνες δισκέτας είναι ακατέργαστες και λειτουργούν παντού.

## Γνωστοί Περιορισμοί

- **Δεν περιλαμβάνεται το DOS Shell**: Ο πηγαίος κώδικας του DOS Shell (DOSSHELL) δεν έγινε ανοιχτός. Το SELECT.EXE (ο εγκαταστάτης) μοιράζεται κάποιον κώδικα με το DOSSHELL και δεν μπορεί να κατασκευαστεί.
- **Ημιτελής επωνυμία PC-DOS**: Η κατασκευή `--flavor=pcdos` χρησιμοποιεί ονόματα αρχείων συστήματος της IBM (IBMBIO.COM, IBMDOS.COM) και κάποιες διαδρομές κώδικα ειδικά για το PC-DOS, αλλά εξακολουθεί να εμφανίζει "MS-DOS" στο VER και το banner εκκίνησης. Αυτό συμβαίνει επειδή το αρχείο μηνυμάτων της IBM (`usa-ibm.msg` ή παρόμοιο) δεν έγινε ανοιχτό -- μόνο το `usa-ms.msg` με επωνυμία Microsoft κυκλοφόρησε.
- **Κατασκευή μη-IBM-συμβατή**: Μια τρίτη διαμόρφωση (`IBMVER=FALSE`) υπάρχει στον πηγαίο κώδικα για μη-IBM-συμβατό υλικό, αλλά δεν κατασκευάζεται επιτυχώς. Φαίνεται ότι αυτή η διαμόρφωση είναι για κάποια από τα βραχύβια μη-IBM-συμβατά x86 PC από τις αρχές της δεκαετίας του 1980 -- συγκεκριμένα αποφεύγει ορισμένες διαδρομές κώδικα ειδικές για IBM-συμβατά που σχετίζονται με υλικό όπως το BIOS, PIC, PIT, κ.ο.κ. Απαιτείται περαιτέρω έρευνα, αλλά είναι πιθανό ότι αυτό το δέντρο πηγαίου κώδικα είναι ημιτελές και του λείπει ο κώδικας ειδικός για το υλικό (πράγματα IO.SYS) που θα έπρεπε να παρασχεθεί για την υλοποίηση των υπηρεσιών DOS σε τέτοιο υλικό.

# Εμπορικά Σήματα

Αυτό το project μπορεί να περιέχει εμπορικά σήματα ή λογότυπα για projects, προϊόντα ή υπηρεσίες. Η εξουσιοδοτημένη χρήση εμπορικών σημάτων ή λογοτύπων της Microsoft υπόκειται και πρέπει να ακολουθεί τις
[Οδηγίες Εμπορικών Σημάτων και Επωνυμίας της Microsoft](https://www.microsoft.com/legal/intellectualproperty/trademarks/usage/general).
Η χρήση εμπορικών σημάτων ή λογοτύπων της Microsoft σε τροποποιημένες εκδόσεις αυτού του project δεν πρέπει να προκαλεί σύγχυση ή να υπονοεί χορηγία από τη Microsoft.
Οποιαδήποτε χρήση εμπορικών σημάτων ή λογοτύπων τρίτων υπόκειται στις πολιτικές αυτών των τρίτων.
